library(tidyverse)
library(knitr)
opts_chunk$set(warning = FALSE, message = FALSE)
# load data sets
income <- read_csv('IRSIncomeByZipCode.csv')
zips <- read_csv('uszips.csv')
View(income)
View(income)
# load data sets
income <- read_csv('IRSIncomeByZipCode.csv')
zips <- read_csv('uszips.csv')
state <- read_csv('statenamecode.csv')
View(state)
View(state)
library(tidyverse)
library(knitr)
opts_chunk$set(warning = FALSE, message = FALSE)
# load data sets
income <- read_csv('IRSIncomeByZipCode.csv')
state <- read_csv('statenamecode.csv')
# tidy data to only include variables that will be used
income <- income %>% select(index,
ZIPCODE,
`Adjusted gross income (AGI)`)
# rename some columns in <income>
income <- income %>%
rename(
zip = ZIPCODE,
agi = `Adjusted gross income (AGI)`
)
# create new variable that contains quartiles
income <- income %>%
mutate(percentile = case_when(agi <= 33003 ~ "25%",
agi > 33003 & agi <= 67463 ~ "50%",
agi > 67463 & agi <= 122500 ~ "75%",
agi > 122500 ~ "0%"))
library(tidyverse)
library(knitr)
opts_chunk$set(warning = FALSE, message = FALSE)
# load data sets
income <- read_csv('IRSIncomeByZipCode.csv')
state <- read_csv('statenamecode.csv')
View(income)
View(income)
# load data sets
income <- read_csv('IRSIncomeByZipCode.csv')
state_codes <- read_csv('statenamecode.csv')
state_temps <- read_csv('statetemps.csv')
# load data sets
income <- read_csv('IRSIncomeByZipCode.csv')
state_codes <- read_csv('statenamecode.csv')
state_temps <- read_csv('statetemps.csv')
# tidy data to only include variables that will be used
income <- income %>% select(index,
ZIPCODE,
STATE,
`Adjusted gross income (AGI)`)
# rename some columns in <income>
income <- income %>%
rename(
zip = ZIPCODE,
state = STATE,
agi = `Adjusted gross income (AGI)`
)
# create new variable that contains quartiles
income <- income %>%
mutate(percentile = case_when(agi <= 33003 ~ "25%",
agi > 33003 & agi <= 67463 ~ "50%",
agi > 67463 & agi <= 122500 ~ "75%",
agi > 122500 ~ "0%"))
View(state_temps)
View(state_temps)
View(state_codes)
View(state_codes)
View(state)
# left merge
state_temps <- merge(x = state_temps, y = state_codes, by = "State")
# further wrangle <state_temps>
state_temps <- state_temps %>%
select(State,
`Avg C`,
Code)
library(tidyverse)
library(knitr)
opts_chunk$set(warning = FALSE, message = FALSE)
# load data sets
income <- read_csv('IRSIncomeByZipCode.csv')
state_codes <- read_csv('statenamecode.csv')
state_temps <- read_csv('statetemps.csv')
# tidy data to only include variables that will be used
income <- income %>% select(index,
ZIPCODE,
STATE,
`Adjusted gross income (AGI)`)
# rename some columns in <income>
income <- income %>%
rename(
zip = ZIPCODE,
state = STATE,
agi = `Adjusted gross income (AGI)`
)
# create new variable that contains quartiles
income <- income %>%
mutate(percentile = case_when(agi <= 33003 ~ "25%",
agi > 33003 & agi <= 67463 ~ "50%",
agi > 67463 & agi <= 122500 ~ "75%",
agi > 122500 ~ "0%"))
# left merge
state_temps <- merge(x = state_temps, y = state_codes, by = "State")
# further wrangle <state_temps>
state_temps <- state_temps %>%
select(State,
`Avg C`,
Code)
# further wrangle <state_temps>
state_temps <- state_temps %>%
select(State,
`Avg C`,
Code) %>%
rename(
state = State,
temp = `Avg C`,
code = Code
)
state_temps_income <- merge(x = income, y = state_temps, by = "state")
View(state_temps_income)
gc()
library(tidyverse)
library(knitr)
opts_chunk$set(warning = FALSE, message = FALSE)
# load data sets
income <- read_csv('IRSIncomeByZipCode.csv')
state_codes <- read_csv('statenamecode.csv')
state_temps <- read_csv('statetemps.csv')
# tidy data to only include variables that will be used
income <- income %>% select(index,
ZIPCODE,
STATE,
`Adjusted gross income (AGI)`)
# rename some columns in <income>
income <- income %>%
rename(
zip = ZIPCODE,
state_code = STATE,
agi = `Adjusted gross income (AGI)`
)
# create new variable that contains quartiles
income <- income %>%
mutate(percentile = case_when(agi <= 33003 ~ "25%",
agi > 33003 & agi <= 67463 ~ "50%",
agi > 67463 & agi <= 122500 ~ "75%",
agi > 122500 ~ "0%"))
# left merge
state_temps <- merge(x = state_temps, y = state_codes, by = "State")
# further wrangle <state_temps>
state_temps <- state_temps %>%
select(State,
`Avg C`,
Code) %>%
rename(
state_name = State,
temp = `Avg C`,
state_code = Code
)
state_temps_income <- merge(x = income, y = state_temps, by = "state")
state_temps_income <- merge(x = income, y = state_temps, by = "state_code")
View(state_temps_income)
View(state_temps_income)
state_temps_income %>%
ggplot(aes(x = temp, y = agi)) +
geom_point(alpha = 0.5) +
geom_smooth(method = 'lm', se = FALSE) +
theme_minimal()
state_temps_income %>%
filter(agi < 504420) %>%
ggplot(aes(x = temp, y = agi)) +
geom_point(alpha = 0.5) +
geom_smooth(method = 'lm', se = FALSE) +
theme_minimal()
library(tidyverse)
library(knitr)
opts_chunk$set(warning = FALSE, message = FALSE)
# load data sets
income <- read_csv('IRSIncomeByZipCode.csv')
zips <- read_csv('uszips.csv')
state <- read_csv('statenamecode.csv')
# tidy data to only include variables that will be used
income <- income %>% select(index,
ZIPCODE,
`Adjusted gross income (AGI)`)
zips <- zips %>% select(zip,
lat,
lng,
city,
state_id)
# rename some columns in <income>
income <- income %>%
rename(
zip = ZIPCODE,
agi = `Adjusted gross income (AGI)`
)
# create new variable that contains the 10th percentile
income <- income %>%
mutate(percentile = case_when(agi <= 33003 ~ "0%",
agi > 33003 & agi <= 67463 ~ "75%",
agi > 67463 & agi <= 122500 ~ "50%",
agi > 122500 ~ "25%"))
# only consider continental U.S.
zips <- zips %>%
filter(lat < 49,
lat > 24.5465)
# filter out the top 1% of earners
# https://www.investopedia.com/personal-finance/how-much-income-puts-you-top-1-5-10/
# income <- income %>%
#   filter(agi <= 823763)
# left merge
location_income <- merge(x = income, y = zips, by = "zip")
location_income %>% ggplot(aes(x = lat, y = agi)) +
geom_point(alpha = 0.5) +
geom_smooth(method = 'lm', se = FALSE) +
facet_wrap(~percentile, scales = "free") +
theme_minimal()
location_income %>%
filter(agi < 504420) %>%
ggplot(aes(x = lat, y = agi)) +
geom_point(alpha = 0.5) +
geom_smooth(method = 'lm', se = FALSE) +
theme_minimal()
state_temps_income %>%
filter(agi < 504420,
state_code != 'AK') %>%
ggplot(aes(x = temp, y = agi)) +
geom_point(alpha = 0.5) +
geom_smooth(method = 'lm', se = FALSE) +
theme_minimal()
state_temps_income %>%
filter(agi < 504420) %>%
ggplot(aes(x = temp, y = agi)) +
geom_point(alpha = 0.5) +
geom_smooth(method = 'lm', se = FALSE) +
theme_minimal()
model1 <- lm(agi ~ temp, data = state_temps_income)
summary(model1)$coefficients
cor(x = state_temps_income$temp, y = state_temps_income$agi)
summary(model1)$r.squared
state_temps_income %>%
filter(agi < 504420) %>%
ggplot(aes(x = temp, y = agi)) +
geom_point(alpha = 0.5) +
geom_smooth(method = 'lm', se = FALSE) +
theme_minimal()
model1 <- state_temps_income %>% filter(agi < 504420) %>% lm(agi ~ temp, data = state_temps_income)
lower <- state_temps_income %>% filter(agi < 504420)
model1 <- lm(agi ~ temp, data = lower)
summary(model1)$coefficients
cor(x = lower$temp, y = lower$agi)
summary(model1)$r.squared
state_temps_income %>%
ggplot(aes(x = temp, y = agi)) +
geom_point(alpha = 0.5) +
geom_smooth(method = 'lm', se = FALSE) +
theme_minimal()
model1 <- lm(agi ~ temp, data = state_temps_income)
summary(model1)$coefficients
cor(x = state_temps_income$temp, y = state_temps_income$agi)
summary(model1)$r.squared
lower <- state_temps_income %>% filter(agi < 5044200)
model1 <- lm(agi ~ temp, data = lower)
summary(model1)$coefficients
cor(x = lower$temp, y = lower$agi)
summary(model1)$r.squared
state_temps_income %>%
filter(agi < 5044200) %>%
ggplot(aes(x = temp, y = agi)) +
geom_point(alpha = 0.5) +
geom_smooth(method = 'lm', se = FALSE) +
theme_minimal()
lower <- state_temps_income %>% filter(agi < 504420)
model1 <- lm(agi ~ temp, data = lower)
summary(model1)$coefficients
cor(x = lower$temp, y = lower$agi)
summary(model1)$r.squared
state_temps_income %>%
filter(agi < 504420) %>%
ggplot(aes(x = temp, y = agi)) +
geom_point(alpha = 0.5) +
geom_smooth(method = 'lm', se = FALSE) +
theme_minimal()
lower <- state_temps_income %>% filter(agi < 1600000)
model1 <- lm(agi ~ temp, data = lower)
summary(model1)$coefficients
cor(x = lower$temp, y = lower$agi)
summary(model1)$r.squared
state_temps_income %>%
filter(agi < 1600000) %>%
ggplot(aes(x = temp, y = agi)) +
geom_point(alpha = 0.5) +
geom_smooth(method = 'lm', se = FALSE) +
theme_minimal()
